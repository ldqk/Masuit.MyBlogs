myApp.controller("system",["$scope","$http",function(n,t){window.hub.disconnect();n.request("/system/getsettings",null,function(t){var i={};Enumerable.From(t.Data).Select(n=>({name:n.Name,value:n.Value})).Distinct().ToArray().map(function(n){i[n.name]=n.value});n.Settings=i});n.setImage=function(i){swal({title:"请选择一张图片",input:"file",showCloseButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",showLoaderOnConfirm:!0,animation:!0,allowOutsideClick:!1,inputAttributes:{accept:"image/*"},preConfirm:function(n){return new Promise(function(i){if(n){var r=new FileReader;r.onload=function(n){t.post("/upload/DecodeDataUri",{data:n.target.result}).then(function(n){i(n.data.Data)},function(){})};r.readAsDataURL(n)}else reject("请选择图片")})},inputValidator:function(n){return new Promise(function(t,i){n?t():i("请选择图片")})}}).then(function(t){n.$apply(function(){n.Settings[i]=t})}).catch(swal.noop)};n.save=function(){swal({title:"确认保存吗？",type:"warning",showCloseButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",showLoaderOnConfirm:!0,animation:!0,allowOutsideClick:!1,preConfirm:function(){return new Promise(function(i,r){var f=[];for(var u in n.Settings)n.Settings.hasOwnProperty(u)&&f.push({Name:u,Value:n.Settings[u]});t.post("/system/save",{sets:JSON.stringify(f)},{"Content-Type":"application/x-www-form-urlencoded"}).then(function(n){i(n.data)},function(){r("请求服务器失败！")})})}}).then(function(n){swal({type:n.Success?"success":"error",text:n.Message})}).catch(swal.noop)};n.mailtest=function(){t.post("/system/mailtest",{smtp:n.Settings.SMTP,user:n.Settings.EmailFrom,pwd:n.Settings.EmailPwd,port:n.Settings.SmtpPort,to:n.Settings.ReceiveEmail}).then(function(n){n.data.Success?swal(n.data.Message,"","success"):swal({input:"textarea",showCloseButton:!0,width:800,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",inputValue:n.data.Message,inputClass:"height700"})},function(){swal("服务请求失败","","error")}).catch(swal.noop)};n.pathtest=function(){t.post("/system/pathtest",{path:n.Settings.PathRoot}).then(function(n){n.data.Success?swal(n.data.Message,"","success"):swal({input:"textarea",showCloseButton:!0,width:800,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",inputValue:n.data.Message,inputClass:"height700"})},function(){swal("服务请求失败","","error")}).catch(swal.noop)};n.DisabledEmailBroadcast=function(){n.Settings.DisabledEmailBroadcast=n.Settings.DisabledEmailBroadcast=="true"?"false":"true"}}]);myApp.controller("log",["$scope","$http",function(n){window.hub.disconnect();n.getfiles=function(){n.request("/dashboard/GetLogfiles",null,function(t){n.files=t.Data})};n.getfiles();n.view=function(t){n.request("/dashboard/catlog",{filename:t},function(n){swal({input:"textarea",showCloseButton:!0,width:1e3,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",inputValue:n.Data,inputClass:"height700"})})};n.delete=function(t){swal({title:"确定删除吗？",type:"warning",showCancelButton:!0,showCloseButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"确定",cancelButtonText:"取消",preConfirm:function(){return new Promise(function(i){n.request("/dashboard/deletefile",{filename:t},function(t){n.getfiles();i(t.Message)})})}}).then(function(n){swal(n,"","success")}).catch(swal.noop)}}]);myApp.controller("email",["$scope","$http",function(n){window.hub.disconnect();n.getfiles=function(){n.request("/file/Getfiles",{path:"/template"},function(t){n.files=t.Data})};n.getfiles();n.view=function(t){n.request("/file/read",{filename:t},function(i){swal({input:"textarea",showCloseButton:!0,width:1e3,showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"确定",cancelButtonText:"取消",inputValue:i.Data,inputClass:"height700",preConfirm:function(i){return new Promise(function(r,u){i?n.request("/file/save",{filename:t,content:i},function(n){n.Success?r(n.Message):u(n.Message)}):u("请输入内容")})}}).then(function(n){swal(n,"","success")}).catch(swal.noop)})}}]);myApp.controller("file",["$scope","$http",function(){window.hub.disconnect()}]);myApp.controller("task",["$scope","$http",function(){window.hub.disconnect()}]);myApp.controller("firewall",["$scope","$http","NgTableParams","$timeout",function(n,t,i,r){window.hub.disconnect();var u=this,f=[];u.data={};n.request("/system/getsettings",null,function(t){var i={};Enumerable.From(t.Data).Select(n=>({name:n.Name,value:n.Value})).Distinct().ToArray().map(function(n){i[n.name]=n.value});n.Settings=i});this.load=function(){n.request("/system/InterceptLog",null,function(t){u.tableParams=new i({},{filterDelay:0,dataset:t.Data.list});f=t.Data.list;n.interceptCount=t.Data.interceptCount})};u.load();this.clear=function(){swal({title:"确定清空拦截日志吗？",type:"warning",showCancelButton:!0,showCloseButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"确定",cancelButtonText:"取消",preConfirm:function(){return new Promise(function(t){n.request("/system/ClearInterceptLog",null,function(n){t(n.Message)})})}}).then(function(n){swal(n,"","success");u.load()}).catch(swal.noop)};n.EnableDenyAreaPolicy=function(){n.Settings.EnableDenyArea=n.Settings.EnableDenyArea=="true"?"false":"true"};n.getIPBlackList=function(){n.request("/system/IpBlackList",null,function(t){swal({title:"编辑全局IP黑名单",text:"多个IP之间用英文逗号分隔",input:"textarea",showCloseButton:!0,width:1e3,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",inputValue:t.Data,inputClass:"height700",showLoaderOnConfirm:!0,preConfirm:function(t){return new Promise(function(i){n.request("/system/SetIpBlackList",{content:t},function(n){i(n.Message)})})}}).then(function(){swal("更新成功","","success")}).catch(swal.noop)})};n.getIPWhiteList=function(){n.request("/system/IpWhiteList",null,function(t){swal({title:"编辑全局IP白名单",text:"多个IP之间用英文逗号分隔",input:"textarea",showCloseButton:!0,width:1e3,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",inputValue:t.Data,inputClass:"height700",showLoaderOnConfirm:!0,preConfirm:function(t){return new Promise(function(i){n.request("/system/SetIpWhiteList",{content:t},function(n){i(n.Message)})})}}).then(function(){swal("更新成功","","success")}).catch(swal.noop)})};n.getAreaIPBlackList=function(){n.request("/system/AreaIPBlackList",null,function(t){layer.open({type:1,zIndex:20,title:"查看地区IP黑名单",area:(window.screen.width>360?360:window.screen.width)+"px",content:$("#modal"),success:function(){$(".ui.dropdown.region").dropdown({onChange:function(t){n.AreaIPs=n.AreaIPBlackList[t];n.AreaIPsCopy=n.AreaIPBlackList[t]},message:{maxSelections:"最多选择 {maxCount} 项",noResults:"无搜索结果！"}});n.AreaIPBlackList=t.Data;n.Areas=Object.keys(t.Data);r(function(){$(".ui.dropdown.region").dropdown("set selected",[n.Areas[0]])},100)},end:function(){$("#modal").css("display","none")}})})};n.getIPRangeBlackList=function(){n.request("/system/GetIPRangeBlackList",null,function(t){swal({title:"编辑IP地址段黑名单",text:"每行一条地址段，起始地址和结束地址用空格分隔开，其余信息也用空格分隔开",input:"textarea",showCloseButton:!0,width:1e3,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",inputValue:t.Data,inputClass:"height700",showLoaderOnConfirm:!0,preConfirm:function(t){return new Promise(function(i){n.request("/system/SetIPRangeBlackList",{content:t},function(n){i(n.Message)})})}}).then(function(){swal("更新成功","","success")}).catch(swal.noop)})};n.save=function(){swal({title:"确认保存吗？",type:"warning",showCloseButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",showLoaderOnConfirm:!0,animation:!0,allowOutsideClick:!1,preConfirm:function(){return new Promise(function(i,r){var f=[];for(var u in n.Settings)n.Settings.hasOwnProperty(u)&&f.push({Name:u,Value:n.Settings[u]});t.post("/system/save",{sets:JSON.stringify(f)},{"Content-Type":"application/x-www-form-urlencoded"}).then(function(n){i(n.data)},function(){r("请求服务器失败！")})})}}).then(function(n){swal({type:n.Success?"success":"error",text:n.Message})}).catch(swal.noop)};n.addToWhiteList=function(i){swal({title:"确认添加白名单吗？",text:"将"+i+"添加到白名单",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",animation:!0,allowOutsideClick:!1,showLoaderOnConfirm:!0,preConfirm:function(){return new Promise(function(n,r){t.post("/system/AddToWhiteList",{ip:i},{"Content-Type":"application/x-www-form-urlencoded"}).then(function(t){n(t.data)},function(){r("请求服务器失败！")})})}}).then(function(t){t.Success?(n.AreaIPs.remove(i),swal("添加成功","","success")):swal("添加失败","","error")}).catch(swal.noop)};n.searchIP=function(t){n.AreaIPs=t?_.filter(n.AreaIPsCopy,n=>n.indexOf(t)>-1):n.AreaIPsCopy}}]);