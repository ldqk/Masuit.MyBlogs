function submitComment(n){loading();localStorage.setItem("user",JSON.stringify($(n).serializeObject()));$.post("/comment/put",$(n).serialize(),n=>{loadingDone(),n.Success?(window.notie.alert({type:1,text:n.Message,time:4}),setTimeout(function(){getcomments();$("[id^='LAY_layedit']").contents().find("body").html("")},100)):window.notie.alert({type:3,text:n.Message,time:4})})}function bindReplyBtn(){$(".msg-list article .panel-body a").on("click",function(n){var t,i,r;n.preventDefault();loadingDone();t=JSON.parse(localStorage.getItem("user"));t&&($("[name='NickName']").val(t.NickName),$("[name='Email']").val(t.Email),$("[name='QQorWechat']").val(t.QQorWechat));i=$(this).attr("href");r=i.substring(i.indexOf("uid")+4);$("#uid").val(r);$("#OperatingSystem2").val(platform.os.toString());$("#Browser2").val(platform.name+" "+platform.version);layui.use("layer",function(){var n=layui.layer;n.open({type:1,zIndex:20,title:"回复评论",area:(window.screen.width>540?540:window.screen.width)+"px",content:$("#reply"),end:function(){$("#reply").css("display","none")}})});$(".layui-layer").insertBefore($(".layui-layer-shade"));window.currentEditor=layui.layedit.build("layedit2",{tool:["strong","italic","link","unlink","face"],height:100})})}function commentVoteBind(){$(".cmvote").on("click",function(){$.post("/comment/CommentVote",{id:$(this).data("id")},n=>{n&&(n.Success?(console.log($(this).children("span.count")),$(this).children("span.count").text(parseInt($(this).children("span.count").text())+1),$(this).addClass("disabled"),this.disabled=!0,window.notie.alert({type:1,text:n.Message,time:4})):window.notie.alert({type:3,text:n.Message,time:4}))})})}function bindVote(){$("#voteup").on("click",function(){$.post("/post/voteup",{id:$("#postId").val()},n=>{n&&(n.Success?($(this).children()[1].innerText=parseInt($(this).children()[1].innerText)+1,$(this).addClass("disabled"),this.disabled=!0,window.notie.alert({type:1,text:n.Message,time:4})):window.notie.alert({type:3,text:n.Message,time:4}))})});$("#votedown").on("click",function(){$.post("/post/votedown",{id:$("#postId").val()},n=>{n&&(n.Success?($(this).children()[1].innerText=parseInt($(this).children()[1].innerText)+1,$(this).addClass("disabled"),this.disabled=!0,window.notie.alert({type:1,text:n.Message,time:4})):window.notie.alert({type:3,text:n.Message,time:4}))})})}$(function(){var i,n,t;$("#toc").show();i=$("#toc").tocify({selectors:".ibox-content h3,.ibox-content h4,.ibox-content h5"}).data("toc-tocify");$(".tocify>.close").on("click",function(){$(this).parent().hide()});SyntaxHighlighter.all();SyntaxHighlighter.defaults.toolbar=!1;layui.use("layedit",function(){layui.layedit.build("layedit",{tool:["strong","italic","link","unlink","face"],height:100})});$("#code-token").on("submit",function(n){n.preventDefault();$.post("/post/CheckViewToken",$(this).serialize(),function(n){n.Success?window.location.reload():window.notie.alert({type:3,text:n.Message,time:4})})});$(".getcode").on("click",function(n){n.preventDefault();$.post("/post/getviewtoken",{__RequestVerificationToken:$("[name=__RequestVerificationToken]").val(),email:$("#email3").val()},function(n){if(n.Success){window.notie.alert({type:1,text:"验证码发送成功，请注意查收邮件，若未收到，请检查你的邮箱地址或邮件垃圾箱！",time:4});window.localStorage.setItem("email",$("#email3").val());$(".getcode").attr("disabled",!0);var t=0,i=setInterval(function(){t++;$(".getcode").text("重新发送("+(120-t)+")");t>120&&clearInterval(i)},1e3)}else window.notie.alert({type:3,text:n.Message,time:4})})});n=JSON.parse(localStorage.getItem("user"));t=localStorage.getItem("email");t&&($("[name='Email']").val(t),$("#email-token").submit());n&&($("[name='NickName']").val(n.NickName),$("[name='Email']").val(n.Email),$("[name='QQorWechat']").val(n.QQorWechat));bindReplyBtn();bindVote();getcomments();commentVoteBind();$("#OperatingSystem").val(platform.os.toString());$("#Browser").val(platform.name+" "+platform.version);$("#comment").on("submit",function(n){if(n.preventDefault(),layui.layedit.sync(1),$("#name").val().trim().length<=1||$("#name").val().trim().length>36){window.notie.alert({type:3,text:"再怎么你也应该留个合理的名字吧，非主流的我可不喜欢！",time:4});return}if(!/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test($("#email").val().trim())){window.notie.alert({type:3,text:"请输入正确的邮箱格式！",time:4});return}if($("#email").val().indexOf("163")>1||$("#email").val().indexOf("126")>1){var t=this;swal({title:"邮箱确认",text:"检测到您输入的邮箱是网易邮箱，本站的邮件服务器可能会因为您的反垃圾设置而无法将邮件正常发送到您的邮箱，建议使用您的其他邮箱，或者检查反垃圾设置后，再点击确定按钮继续！",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"确定",cancelButtonText:"换个邮箱",confirmButtonClass:"btn btn-success btn-lg",cancelButtonClass:"btn btn-danger btn-lg",buttonsStyling:!1}).then(function(n){n===!0&&submitComment(t)});return}submitComment(this)});$(".btn-cancel").click(function(){$(":input","#reply-form").not(":button,:submit,:reset,:hidden").val("").removeAttr("checked").removeAttr("checked");layer.closeAll();setTimeout(function(){$("#reply").css("display","none")},500)});$("#reply-form").on("submit",function(n){if(n.preventDefault(),layui.layedit.sync(window.currentEditor),loading(),$("#name2").val().trim().length<=0||$("#name").val().trim().length>36){window.notie.alert({type:3,text:"亲，能留个正常点的名字不！",time:4});loadingDone();return}if(!/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test($("#email2").val().trim())){window.notie.alert({type:3,text:"请输入正确的邮箱格式！",time:4});loadingDone();return}localStorage.setItem("user",JSON.stringify($(this).serializeObject()));$.post("/comment/put",$(this).serialize(),n=>{loadingDone(),n.Success?(window.notie.alert({type:1,text:n.Message,time:4}),layer.closeAll(),setTimeout(function(){getcomments();$("[id^='LAY_layedit']").contents().find("body").html("");$("#reply").css("display","none")},500)):window.notie.alert({type:3,text:n.Message,time:4})})});$("#donate").on("click",function(){$.post("/system/getsetting",{name:"Donate"},function(n){swal({title:"支付宝扫一扫付款捐赠！",html:"<a href='/donate'>更多方式<\/a>",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",showLoaderOnConfirm:!0,imageUrl:n.Data.Value,imageWidth:400,animation:!0,allowOutsideClick:!1}).then(function(){},function(){swal("您的捐赠将会支持本站做的更好！",null,"error")})})})});