@model string
@{
  ViewBag.Title = "留言板";
  Layout = "~/Views/Shared/_Layout.cshtml";
  string hidden = string.IsNullOrEmpty(Context.Request.Cookies["ValidateKey"]) ? "" : "hidden";
}
<div class="main-container min-height610" id="msgApp">
  <ol class="breadcrumb">
    <li>
      <a asp-action="Index" asp-controller="Home">首页</a>
    </li>
    <li class="current">
      <em>@ViewBag.Title</em>
    </li>
  </ol>
  <div class="copyright-card">
    <h2 class="recommend-title" id="copyright">留言须知：</h2>
    @Html.Raw(Model)
  </div>
  <p>　</p>
  <div class="comment-form">
    @Html.AntiForgeryToken()
    @if (hidden == nameof(hidden)) {
      <p>@Context.Request.Cookies["NickName"] 您好！</p>
    } else {
      <div class="comment-form-row @hidden" style="display:flex;gap:12px;flex-wrap:wrap;">
        <input name="nickname" placeholder="您的称呼" required style="flex:1 1 140px;min-width:120px;" type="text" v-model="msg.NickName">
        <div style="position:relative;flex:1 1 240px;min-width:180px;display:flex;">
          <input name="email" placeholder="您的邮箱" required style="flex:1 1 auto;min-width:120px;padding-right:110px;" type="email" v-model="msg.Email">
          <button :disabled="disableGetcode||!msg.Email" @@click="getcode(msg.Email)" class="comment-form-btn" id="getEmailCodeBtn" style="position:absolute;right:2px;top:50%;transform:translateY(-50%);min-width:96px;height:36px;padding:0 8px;font-size:.97rem;z-index:2;" type="button"> {{codeMsg}} </button>
        </div>
        <input name="emailcode" placeholder="验证码" required style="flex:1 1 110px;min-width:80px;" type="text" v-model="msg.Code">
      </div>
    }
    <!-- 第二行：评论内容框独占一行 -->
    <div class="comment-form-row" style="width:100%;margin-top:12px;">
      <div class="ueditor" id="editor"></div>
    </div>
    <!-- 第三行：协议勾选和提交按钮同一行，右侧提交按钮 -->
    <div class="comment-form-row" style="display:flex;align-items:center;justify-content:space-between;margin-top:12px;gap:18px;">
      <label style="display:flex;align-items:center;font-size:.98rem;color:#1566b6;gap:6px;">
        <input name="agreement" required style="width:18px;height:18px;margin-right:4px;" type="checkbox" v-model="msg.Agree" value="true">
        我已阅读并同意
        <a asp-action="agreement" asp-controller="Misc" style="color:#1e90ff;text-decoration:underline;" target="_blank">《留言须知》</a>
      </label>
      <button @@click="submit(msg)" class="comment-form-btn">发表留言</button>
    </div>
  </div>
  <parent-messages :data="list" :is-admin="false" @@getmsgs="getmsgs" @@reply-msg="replyMsg"></parent-messages>
  <div>
    <n-pagination :page-count="Math.ceil(pageConfig.total / pageConfig.size)" :page-sizes="[10, 20, 30, 50]" show-size-picker v-model:page="pageConfig.page" v-model:page-size="pageConfig.size"/>
  </div>
  <n-modal :mask-closable="false" :title="`回复：${reply.for?.NickName}`" @@positive-click="submit(reply)" negative-text="取消回复" positive-text="回复留言" preset="dialog" style="width:70vw;min-width:400px" v-model:show="showPopup">
    <div class="comment-item" style="max-height: 50vh;overflow-y: scroll;">
      <div class="comment-meta-row">
        <div>
          <span class="comment-author">{{reply.for?.NickName}}</span>
          <span class="comment-time">{{ reply.for?.PostDate }}</span>
        </div>
      </div>
      <div class="comment-content" v-html="reply.for?.Content"></div>
    </div>
    <form class="comment-form">
      @Html.AntiForgeryToken()
      @if (hidden == nameof(hidden)) {
        <p>@Context.Request.Cookies["NickName"] 您好！</p>
      } else {
        <div class="comment-form-row @hidden" style="display:flex;gap:12px;flex-wrap:wrap;">
          <input name="nickname" placeholder="您的称呼" required style="flex:1 1 140px;min-width:120px;" type="text" v-model="reply.NickName">
          <div style="position:relative;flex:1 1 240px;min-width:180px;display:flex;">
            <input name="email" placeholder="您的邮箱" required style="flex:1 1 auto;min-width:120px;padding-right:110px;" type="email" v-model="reply.Email">
            <button :disabled="disableGetcode||!reply.Email" @@click="getcode(reply.Email)" class="comment-form-btn" style="position:absolute;right:2px;top:50%;transform:translateY(-50%);min-width:96px;height:36px;padding:0 8px;font-size:.97rem;z-index:2;" type="button"> {{codeMsg}} </button>
          </div>
          <input name="emailcode" placeholder="验证码" required style="flex:1 1 110px;min-width:80px;" type="text" v-model="reply.Code">
        </div>
      }
      <!-- 第二行：评论内容框独占一行 -->
      <div class="comment-form-row" style="width:100%;margin-top:12px;">
        <div class="ueditor" id="editor2"></div>
      </div>
      <!-- 第三行：协议勾选和提交按钮同一行，右侧提交按钮 -->
      <div class="comment-form-row" style="display:flex;align-items:center;justify-content:space-between;margin-top:12px;gap:18px;">
        <label style="display:flex;align-items:center;font-size:.98rem;color:#1566b6;gap:6px;">
          <input name="agreement" required style="width:18px;height:18px;margin-right:4px;" type="checkbox" v-model="reply.Agree" value="true">
          我已阅读并同意
          <a asp-action="agreement" asp-controller="Misc" style="color:#1e90ff;text-decoration:underline;" target="_blank">《留言须知》</a>
        </label>
      </div>
    </form>
  </n-modal>
</div>
<script src="~/UEditorPlus/ueditor.config.front.js"></script>
<script charset="utf-8" src="~/UEditorPlus/ueditor.all.js" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/npm/dayjs/dayjs.min.js"></script>
<script>
window.defaultUser=function(){
  return {
    NickName: `@Context.Request.Cookies["NickName"]`,
    Email: `@Context.Request.Cookies["Email"]`,
    Agree:true,
    IsAdmin:true
  };
}
</script>
<script src="~/Scripts/global/leavemsg.js"></script>